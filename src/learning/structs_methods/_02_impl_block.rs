// ============================================================
// 02_impl_block.rs - impl å—ä¸Žæ–¹æ³•
// ============================================================
//
// ðŸŽ¯ å­¦ä¹ ç›®æ ‡ï¼šç†è§£å¦‚ä½•ç»™ç»“æž„ä½“æ·»åŠ æ–¹æ³•
//
// impl = implementationï¼ˆå®žçŽ°ï¼‰
// ç”¨ impl å—ç»™ç»“æž„ä½“æ·»åŠ "èƒ½åŠ›"ï¼ˆæ–¹æ³•ï¼‰
//
// ============================================================

/// è¿è¡Œè¿™ä¸ªæ¨¡å—çš„ç¤ºä¾‹
pub fn run() {
    println!("=== impl å—ä¸Žæ–¹æ³• ===\n");

    // --------------------------------------------------------
    // ðŸ“Œ é—®é¢˜å¼•å…¥ï¼šç»“æž„ä½“åªæœ‰æ•°æ®ï¼Œæ²¡æœ‰è¡Œä¸º
    // --------------------------------------------------------
    println!("ã€1ã€‘é—®é¢˜ï¼šç»“æž„ä½“åªæœ‰æ•°æ®ï¼Œæ²¡æœ‰è¡Œä¸º");
    println!();

    let rect = Rectangle {
        width: 30,
        height: 50,
    };

    println!("  åˆ›å»ºäº†ä¸€ä¸ªçŸ©å½¢ï¼š");
    println!("  å®½åº¦: {}", rect.width);
    println!("  é«˜åº¦: {}", rect.height);
    println!();
    println!("  ðŸ˜µ é—®é¢˜ï¼šæƒ³è®¡ç®—é¢ç§¯ï¼Œåªèƒ½å†™ä¸€ä¸ªç‹¬ç«‹çš„å‡½æ•°ï¼Ÿ");
    println!();

    // ç‹¬ç«‹å‡½æ•°ï¼ˆä¸å¤Ÿä¼˜é›…ï¼‰
    fn area_standalone(rect: &Rectangle) -> u32 {
        rect.width * rect.height
    }
    println!("  ç‹¬ç«‹å‡½æ•°: area_standalone(&rect) = {}", area_standalone(&rect));
    println!("  è¿™æ ·å†™ä¸å¤Ÿç›´è§‚...");
    println!();

    // --------------------------------------------------------
    // ðŸ“Œ è§£å†³æ–¹æ¡ˆï¼šç”¨ impl å—æ·»åŠ æ–¹æ³•
    // --------------------------------------------------------
    println!("ã€2ã€‘ç”¨ impl å—ç»™ç»“æž„ä½“æ·»åŠ æ–¹æ³•");
    println!();

    // çŽ°åœ¨å¯ä»¥ç”¨ç‚¹å·è°ƒç”¨æ–¹æ³•äº†ï¼
    println!("  ä½¿ç”¨æ–¹æ³•: rect.area() = {}", rect.area());
    println!();
    println!("  è¯­æ³•å¯¹æ¯”ï¼š");
    println!("    ç‹¬ç«‹å‡½æ•°: area_standalone(&rect)  // è¦ä¼ å…¥ rect");
    println!("    æ–¹æ³•:     rect.area()              // ç›´æŽ¥åœ¨ rect ä¸Šè°ƒç”¨");
    println!();

    // --------------------------------------------------------
    // ðŸ“Œ impl å—çš„è¯­æ³•
    // --------------------------------------------------------
    println!("ã€3ã€‘impl å—çš„è¯­æ³•");
    println!();
    println!("  impl ç»“æž„ä½“å {{");
    println!("      fn æ–¹æ³•å(&self) -> è¿”å›žç±»åž‹ {{");
    println!("          // æ–¹æ³•ä½“");
    println!("      }}");
    println!("  }}");
    println!();
    println!("  å®žé™…ä¾‹å­ï¼š");
    println!("  impl Rectangle {{");
    println!("      fn area(&self) -> u32 {{");
    println!("          self.width * self.height");
    println!("      }}");
    println!("  }}");
    println!();

    // --------------------------------------------------------
    // ðŸ“Œ self æ˜¯ä»€ä¹ˆï¼Ÿ
    // --------------------------------------------------------
    println!("ã€4ã€‘self æ˜¯ä»€ä¹ˆï¼Ÿ");
    println!();
    println!("  self = è°ƒç”¨è¿™ä¸ªæ–¹æ³•çš„å®žä¾‹æœ¬èº«");
    println!();
    println!("  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”");
    println!("  â”‚  rect.area()                                    â”‚");
    println!("  â”‚    â†“                                            â”‚");
    println!("  â”‚  self å°±æ˜¯ rect                                 â”‚");
    println!("  â”‚  self.width = rect.width = 30                   â”‚");
    println!("  â”‚  self.height = rect.height = 50                 â”‚");
    println!("  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜");
    println!();

    // self çš„ä¸‰ç§å½¢å¼
    println!("  self çš„ä¸‰ç§å½¢å¼ï¼š");
    println!("  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”");
    println!("  â”‚   å†™æ³•      â”‚   å«ä¹‰                             â”‚");
    println!("  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤");
    println!("  â”‚ &self       â”‚ å€Ÿç”¨è‡ªå·±ï¼ˆåªè¯»ï¼‰                   â”‚");
    println!("  â”‚ &mut self   â”‚ å¯å˜å€Ÿç”¨è‡ªå·±ï¼ˆå¯ä¿®æ”¹ï¼‰             â”‚");
    println!("  â”‚ self        â”‚ èŽ·å–æ‰€æœ‰æƒï¼ˆå¾ˆå°‘ç”¨ï¼‰               â”‚");
    println!("  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜");
    println!();

    // --------------------------------------------------------
    // ðŸ“Œ æ–¹æ³•ç¤ºä¾‹ï¼šåªè¯»æ–¹æ³•
    // --------------------------------------------------------
    println!("ã€5ã€‘åªè¯»æ–¹æ³•ï¼ˆ&selfï¼‰");
    println!();

    println!("  rect.area() = {}", rect.area());
    println!("  rect.perimeter() = {}", rect.perimeter());
    println!("  rect.is_square() = {}", rect.is_square());
    println!();

    let square = Rectangle {
        width: 20,
        height: 20,
    };
    println!("  square.is_square() = {}", square.is_square());
    println!();

    // --------------------------------------------------------
    // ðŸ“Œ æ–¹æ³•ç¤ºä¾‹ï¼šä¿®æ”¹æ–¹æ³•
    // --------------------------------------------------------
    println!("ã€6ã€‘ä¿®æ”¹æ–¹æ³•ï¼ˆ&mut selfï¼‰");
    println!();

    let mut growing_rect = Rectangle {
        width: 10,
        height: 10,
    };

    println!("  ä¿®æ”¹å‰: {}x{}", growing_rect.width, growing_rect.height);
    growing_rect.double_size();  // è°ƒç”¨ä¿®æ”¹æ–¹æ³•
    println!("  ä¿®æ”¹åŽ: {}x{}", growing_rect.width, growing_rect.height);
    println!();
    println!("  ðŸ’¡ è¦è°ƒç”¨ &mut self æ–¹æ³•ï¼Œå˜é‡å¿…é¡»æ˜¯ mut çš„");
    println!();

    // --------------------------------------------------------
    // ðŸ“Œ å¸¦å‚æ•°çš„æ–¹æ³•
    // --------------------------------------------------------
    println!("ã€7ã€‘å¸¦å‚æ•°çš„æ–¹æ³•");
    println!();

    let rect1 = Rectangle { width: 30, height: 50 };
    let rect2 = Rectangle { width: 10, height: 40 };
    let rect3 = Rectangle { width: 60, height: 45 };

    println!("  rect1: {}x{}", rect1.width, rect1.height);
    println!("  rect2: {}x{}", rect2.width, rect2.height);
    println!("  rect3: {}x{}", rect3.width, rect3.height);
    println!();
    println!("  rect1.can_hold(&rect2) = {}", rect1.can_hold(&rect2));  // true
    println!("  rect1.can_hold(&rect3) = {}", rect1.can_hold(&rect3));  // false
    println!();

    // --------------------------------------------------------
    // ðŸ“Œ æ–¹æ³• vs å‡½æ•° å¯¹æ¯”
    // --------------------------------------------------------
    println!("ã€8ã€‘æ–¹æ³• vs å‡½æ•° å¯¹æ¯”");
    println!();
    println!("  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”");
    println!("  â”‚            â”‚ å‡½æ•°                â”‚ æ–¹æ³•                â”‚");
    println!("  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤");
    println!("  â”‚ å®šä¹‰ä½ç½®   â”‚ ä»»æ„ä½ç½®            â”‚ impl å—å†…           â”‚");
    println!("  â”‚ ç¬¬ä¸€ä¸ªå‚æ•° â”‚ æ™®é€šå‚æ•°            â”‚ selfï¼ˆè‡ªèº«ï¼‰        â”‚");
    println!("  â”‚ è°ƒç”¨æ–¹å¼   â”‚ func(arg)           â”‚ instance.method()   â”‚");
    println!("  â”‚ å½’å±ž       â”‚ ç‹¬ç«‹å­˜åœ¨            â”‚ å±žäºŽæŸä¸ªç±»åž‹        â”‚");
    println!("  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜");
    println!();

    println!("=== ç¤ºä¾‹ç»“æŸ ===");
    println!("\nðŸ“š ä¸‹ä¸€æ­¥ï¼šå­¦ä¹ å…³è”å‡½æ•°ï¼ˆString::from çš„ç§˜å¯†ï¼ï¼‰");
}

// ============================================================
// ç»“æž„ä½“å®šä¹‰
// ============================================================

/// çŸ©å½¢ç»“æž„ä½“
struct Rectangle {
    width: u32,
    height: u32,
}

// ============================================================
// impl å— - ç»™ Rectangle æ·»åŠ æ–¹æ³•
// ============================================================

impl Rectangle {
    /// è®¡ç®—é¢ç§¯ï¼ˆåªè¯»æ–¹æ³•ï¼‰
    fn area(&self) -> u32 {
        self.width * self.height
    }

    /// è®¡ç®—å‘¨é•¿ï¼ˆåªè¯»æ–¹æ³•ï¼‰
    fn perimeter(&self) -> u32 {
        2 * (self.width + self.height)
    }

    /// æ˜¯å¦æ˜¯æ­£æ–¹å½¢ï¼ˆåªè¯»æ–¹æ³•ï¼‰
    fn is_square(&self) -> bool {
        self.width == self.height
    }

    /// æŠŠå°ºå¯¸ç¿»å€ï¼ˆä¿®æ”¹æ–¹æ³•ï¼‰
    fn double_size(&mut self) {
        self.width *= 2;
        self.height *= 2;
    }

    /// åˆ¤æ–­èƒ½å¦å®¹çº³å¦ä¸€ä¸ªçŸ©å½¢ï¼ˆå¸¦å‚æ•°çš„æ–¹æ³•ï¼‰
    fn can_hold(&self, other: &Rectangle) -> bool {
        self.width > other.width && self.height > other.height
    }
}
