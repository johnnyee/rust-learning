// ============================================================
// 02_move_semantics.rs - Move è¯­ä¹‰ï¼ˆæ‰€æœ‰æƒè½¬ç§»ï¼‰
// ============================================================
//
// ğŸ¯ å­¦ä¹ ç›®æ ‡ï¼šç†è§£ Move è¯­ä¹‰
//
// å½“ä½ æŠŠä¸€ä¸ªå †ä¸Šçš„å€¼èµ‹ç»™å¦ä¸€ä¸ªå˜é‡æ—¶ï¼Œæ‰€æœ‰æƒä¼šã€Œç§»åŠ¨ã€
// åŸæ¥çš„å˜é‡å°±å¤±æ•ˆäº†ï¼Œä¸èƒ½å†ä½¿ç”¨
//
// è¿è¡Œæ–¹å¼: cargo run --example 02_move_semantics
// ============================================================

fn main() {
    println!("=== Move è¯­ä¹‰è¯¦è§£ ===\n");

    // --------------------------------------------------------
    // ğŸ“Œ Move çš„åŸºæœ¬æ¦‚å¿µ
    // --------------------------------------------------------
    println!("ã€1ã€‘Move çš„åŸºæœ¬æ¦‚å¿µ");
    println!();

    let s1 = String::from("hello");
    println!("  åˆ›å»º s1: \"{}\"", s1);
    println!("  s1 çš„å†…å­˜å¸ƒå±€:");
    println!("    æ ˆä¸Š: ptr -> å †åœ°å€, len = 5, capacity = 5");
    println!("    å †ä¸Š: ['h', 'e', 'l', 'l', 'o']");
    println!();

    let s2 = s1;  // æ‰€æœ‰æƒä» s1 ç§»åŠ¨åˆ° s2
    println!("  æ‰§è¡Œ let s2 = s1; å:");
    println!("    s1: å·²å¤±æ•ˆ âŒ");
    println!("    s2: \"{}\" âœ…", s2);
    println!();

    // å¦‚æœå–æ¶ˆæ³¨é‡Šä¸‹é¢è¿™è¡Œï¼Œä¼šç¼–è¯‘é”™è¯¯ï¼š
    // println!("{}", s1);  // âŒ error[E0382]: borrow of moved value: `s1`

    println!("  ğŸ’¡ ä¸ºä»€ä¹ˆè¦ Move è€Œä¸æ˜¯å¤åˆ¶ï¼Ÿ");
    println!("     - å¦‚æœ s1 å’Œ s2 éƒ½æŒ‡å‘åŒä¸€å—å †å†…å­˜");
    println!("     - å½“å®ƒä»¬ç¦»å¼€ä½œç”¨åŸŸæ—¶ï¼Œä¼šå°è¯•é‡Šæ”¾ä¸¤æ¬¡");
    println!("     - è¿™å°±æ˜¯ã€ŒåŒé‡é‡Šæ”¾ã€é”™è¯¯ï¼ŒRust é€šè¿‡ Move é¿å…å®ƒ");
    println!();

    // --------------------------------------------------------
    // ğŸ“Œ Move çš„å†…å­˜å›¾è§£
    // --------------------------------------------------------
    println!("ã€2ã€‘Move å‰åçš„å†…å­˜å˜åŒ–");
    println!();
    println!("  Move å‰:");
    println!("  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”");
    println!("  â”‚     s1      â”‚");
    println!("  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”");
    println!("  â”‚ ptr â”€â”€â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€>â”‚ h â”‚ e â”‚ l â”‚ l â”‚ o â”‚");
    println!("  â”‚ len = 5     â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜");
    println!("  â”‚ capacity = 5â”‚           å †å†…å­˜");
    println!("  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜");
    println!("       æ ˆå†…å­˜");
    println!();
    println!("  Move å (let s2 = s1):");
    println!("  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”");
    println!("  â”‚ s1 (å¤±æ•ˆ)   â”‚");
    println!("  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜");
    println!("  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”");
    println!("  â”‚     s2      â”‚");
    println!("  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”");
    println!("  â”‚ ptr â”€â”€â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€>â”‚ h â”‚ e â”‚ l â”‚ l â”‚ o â”‚");
    println!("  â”‚ len = 5     â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜");
    println!("  â”‚ capacity = 5â”‚           å †å†…å­˜");
    println!("  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜");
    println!("       æ ˆå†…å­˜");
    println!();

    // --------------------------------------------------------
    // ğŸ“Œ å‡½æ•°ä¼ å‚ä¹Ÿä¼š Move
    // --------------------------------------------------------
    println!("ã€3ã€‘å‡½æ•°ä¼ å‚æ—¶çš„ Move");
    println!();

    let name = String::from("JohnYe");
    println!("  åˆ›å»º name: \"{}\"", name);

    print_string(name);  // name çš„æ‰€æœ‰æƒç§»åŠ¨åˆ°å‡½æ•°å†…

    // ä¸‹é¢è¿™è¡Œä¼šç¼–è¯‘é”™è¯¯ï¼š
    // println!("  name = {}", name);  // âŒ error: value borrowed after move

    println!("  è°ƒç”¨å‡½æ•°åï¼Œname å·²å¤±æ•ˆï¼Œä¸èƒ½å†ä½¿ç”¨");
    println!();

    // --------------------------------------------------------
    // ğŸ“Œ å¦‚ä½•åœ¨ Move åç»§ç»­ä½¿ç”¨ï¼Ÿ
    // --------------------------------------------------------
    println!("ã€4ã€‘è§£å†³æ–¹æ¡ˆé¢„è§ˆ");
    println!();
    println!("  æ–¹æ¡ˆ1: Clone - æ·±æ‹·è´ï¼ˆä¸‹ä¸€ä¸ªç¤ºä¾‹è¯¦ç»†è®²ï¼‰");

    let original = String::from("åŸå§‹æ•°æ®");
    let cloned = original.clone();  // åˆ›å»ºå®Œæ•´å‰¯æœ¬
    println!("    original: \"{}\"", original);  // âœ… ä»ç„¶æœ‰æ•ˆ
    println!("    cloned: \"{}\"", cloned);
    println!();

    println!("  æ–¹æ¡ˆ2: å€Ÿç”¨ - ä¸è½¬ç§»æ‰€æœ‰æƒï¼ˆåé¢çš„ç¤ºä¾‹è¯¦ç»†è®²ï¼‰");

    let data = String::from("å€Ÿç”¨çš„æ•°æ®");
    print_borrowed(&data);  // ä¼ é€’å¼•ç”¨ï¼Œä¸è½¬ç§»æ‰€æœ‰æƒ
    println!("    è°ƒç”¨å data: \"{}\"", data);  // âœ… ä»ç„¶æœ‰æ•ˆ
    println!();

    println!("  æ–¹æ¡ˆ3: å‡½æ•°è¿”å›æ‰€æœ‰æƒ");

    let s = String::from("è½¬ç§»åˆè¿”å›");
    let s = take_and_return(s);  // æ‰€æœ‰æƒè½¬ç§»åˆ°å‡½æ•°ï¼Œåˆè¿”å›æ¥
    println!("    è¿”å›å s: \"{}\"", s);  // âœ… æœ‰æ•ˆ
    println!();

    // --------------------------------------------------------
    // ğŸ“Œ ç»ƒä¹ æ€è€ƒ
    // --------------------------------------------------------
    println!("ã€æ€è€ƒé¢˜ã€‘");
    println!();
    println!("  ä¸‹é¢çš„ä»£ç ä¼šç¼–è¯‘é€šè¿‡å—ï¼Ÿ");
    println!();
    println!("  let v1 = vec![1, 2, 3];");
    println!("  let v2 = v1;");
    println!("  println!(\"v1: {{:?}}\", v1);");
    println!();
    println!("  ç­”æ¡ˆ: âŒ ä¸ä¼šï¼Vec å’Œ String ä¸€æ ·æ˜¯å †ä¸Šæ•°æ®ï¼Œä¼š Move");
    println!();

    println!("=== ç¤ºä¾‹ç»“æŸ ===");
    println!("\nğŸ“š ä¸‹ä¸€æ­¥å­¦ä¹ : cargo run --example 03_copy_trait");

    wait_for_enter();
}

fn print_string(s: String) {
    println!("  [å‡½æ•°å†…] æ¥æ”¶åˆ°: \"{}\"", s);
}  // s åœ¨è¿™é‡Œè¢«é‡Šæ”¾

fn print_borrowed(s: &String) {
    println!("    [å‡½æ•°å†…] å€Ÿç”¨: \"{}\"", s);
}  // åªæ˜¯å€Ÿç”¨ï¼Œä¸é‡Šæ”¾

fn take_and_return(s: String) -> String {
    println!("    [å‡½æ•°å†…] å¤„ç†: \"{}\"", s);
    s  // è¿”å›æ‰€æœ‰æƒ
}

fn wait_for_enter() {
    use std::io::{self, Write};
    println!();
    print!("æŒ‰å›è½¦é”®é€€å‡º...");
    io::stdout().flush().unwrap();
    let mut input = String::new();
    io::stdin().read_line(&mut input).unwrap();
}
