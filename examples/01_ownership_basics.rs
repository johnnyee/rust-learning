// ============================================================
// 01_ownership_basics.rs - Rust æ‰€æœ‰æƒåŸºç¡€æ¦‚å¿µ
// ============================================================
//
// ğŸ¯ å­¦ä¹ ç›®æ ‡ï¼šç†è§£æ‰€æœ‰æƒçš„ä¸‰å¤§è§„åˆ™
//
// è§„åˆ™1: æ¯ä¸ªå€¼éƒ½æœ‰ä¸€ä¸ªæ‰€æœ‰è€…ï¼ˆownerï¼‰
// è§„åˆ™2: åŒä¸€æ—¶åˆ»ï¼Œå€¼åªèƒ½æœ‰ä¸€ä¸ªæ‰€æœ‰è€…
// è§„åˆ™3: å½“æ‰€æœ‰è€…ç¦»å¼€ä½œç”¨åŸŸï¼Œå€¼ä¼šè¢«è‡ªåŠ¨é‡Šæ”¾
//
// è¿è¡Œæ–¹å¼: cargo run --example 01_ownership_basics
// ============================================================

fn main() {
    println!("=== Rust æ‰€æœ‰æƒåŸºç¡€ ===\n");

    // --------------------------------------------------------
    // ğŸ“Œ è§„åˆ™1: æ¯ä¸ªå€¼éƒ½æœ‰ä¸€ä¸ªæ‰€æœ‰è€…
    // --------------------------------------------------------
    println!("ã€è§„åˆ™1ã€‘æ¯ä¸ªå€¼éƒ½æœ‰ä¸€ä¸ªæ‰€æœ‰è€…");

    String::from("hello");

    let s = String::from("hello");  // s æ˜¯è¿™ä¸ª String çš„æ‰€æœ‰è€…
    println!("  å˜é‡ s æ‹¥æœ‰å­—ç¬¦ä¸²: \"{}\"", s);

    let x = 42;  // x æ˜¯è¿™ä¸ªæ•´æ•°çš„æ‰€æœ‰è€…
    println!("  å˜é‡ x æ‹¥æœ‰æ•´æ•°: {}", x);
    println!();

    // --------------------------------------------------------
    // ğŸ“Œ è§„åˆ™3: ä½œç”¨åŸŸç»“æŸæ—¶è‡ªåŠ¨é‡Šæ”¾ï¼ˆå…ˆè®²è¿™ä¸ªæ›´å®¹æ˜“ç†è§£ï¼‰
    // --------------------------------------------------------
    println!("ã€è§„åˆ™3ã€‘ç¦»å¼€ä½œç”¨åŸŸæ—¶è‡ªåŠ¨é‡Šæ”¾");

    {
        let inner_string = String::from("æˆ‘åœ¨å†…éƒ¨ä½œç”¨åŸŸ");
        println!("  å†…éƒ¨ä½œç”¨åŸŸ: inner_string = \"{}\"", inner_string);
        // inner_string åœ¨è¿™é‡Œä»ç„¶æœ‰æ•ˆ
    }  // <-- inner_string ç¦»å¼€ä½œç”¨åŸŸï¼Œå†…å­˜è‡ªåŠ¨é‡Šæ”¾ï¼

    // ä¸‹é¢è¿™è¡Œå¦‚æœå–æ¶ˆæ³¨é‡Šï¼Œä¼šç¼–è¯‘é”™è¯¯ï¼š
    // println!("{}", inner_string);  // âŒ error: cannot find value `inner_string`

    println!("  å¤–éƒ¨ä½œç”¨åŸŸ: inner_string å·²ç»è¢«è‡ªåŠ¨é‡Šæ”¾äº†");
    println!();

    // --------------------------------------------------------
    // ğŸ“Œ æ ˆ vs å † - ç†è§£ä¸ºä»€ä¹ˆéœ€è¦æ‰€æœ‰æƒ
    // --------------------------------------------------------
    println!("ã€è¡¥å……ã€‘æ ˆå†…å­˜ vs å †å†…å­˜");

    // æ ˆä¸Šçš„æ•°æ®ï¼šå›ºå®šå¤§å°ï¼Œå¿«é€Ÿåˆ†é…
    let stack_data: i32 = 100;
    println!("  æ ˆä¸Šæ•°æ® (i32): {} - å¤§å°å›ºå®šï¼Œç¼–è¯‘æ—¶å·²çŸ¥", stack_data);

    // å †ä¸Šçš„æ•°æ®ï¼šåŠ¨æ€å¤§å°ï¼Œéœ€è¦ç®¡ç†
    let heap_data = String::from("æˆ‘æ˜¯å †ä¸Šçš„æ•°æ®");
    println!("  å †ä¸Šæ•°æ® (String): \"{}\" - å¤§å°å¯å˜ï¼Œè¿è¡Œæ—¶åˆ†é…", heap_data);
    println!();

    println!("ğŸ’¡ å…³é”®ç†è§£:");
    println!("   - æ ˆæ•°æ®ï¼šå¤åˆ¶æˆæœ¬ä½ï¼ŒRust é»˜è®¤å¤åˆ¶");
    println!("   - å †æ•°æ®ï¼šå¤åˆ¶æˆæœ¬é«˜ï¼ŒRust é»˜è®¤ç§»åŠ¨ï¼ˆMoveï¼‰");
    println!();

    // --------------------------------------------------------
    // ğŸ“Œ å‡½æ•°ä¸æ‰€æœ‰æƒ
    // --------------------------------------------------------
    println!("ã€æ‰©å±•ã€‘å‡½æ•°è°ƒç”¨ä¸æ‰€æœ‰æƒ");

    let my_string = String::from("ä¼ ç»™å‡½æ•°çš„å­—ç¬¦ä¸²");
    println!("  è°ƒç”¨å‡½æ•°å‰: my_string = \"{}\"", my_string);

    takes_ownership(my_string);  // my_string çš„æ‰€æœ‰æƒç§»åŠ¨åˆ°å‡½æ•°å†…

    // ä¸‹é¢è¿™è¡Œå¦‚æœå–æ¶ˆæ³¨é‡Šï¼Œä¼šç¼–è¯‘é”™è¯¯ï¼š
    // println!("{}", my_string);  // âŒ error: value borrowed after move

    println!("  è°ƒç”¨å‡½æ•°å: my_string æ‰€æœ‰æƒå·²è½¬ç§»ï¼Œä¸èƒ½å†ä½¿ç”¨");
    println!();

    // æ•´æ•°æ˜¯ Copy çš„ï¼Œæ‰€ä»¥å¯ä»¥ç»§ç»­ä½¿ç”¨
    let my_number = 42;
    println!("  è°ƒç”¨å‡½æ•°å‰: my_number = {}", my_number);
    makes_copy(my_number);
    println!("  è°ƒç”¨å‡½æ•°å: my_number = {} (ä»ç„¶å¯ç”¨ï¼)", my_number);
    println!();

    // --------------------------------------------------------
    // ğŸ“Œ è¿”å›å€¼ä¸æ‰€æœ‰æƒ
    // --------------------------------------------------------
    println!("ã€æ‰©å±•ã€‘è¿”å›å€¼å¯ä»¥è½¬ç§»æ‰€æœ‰æƒ");

    let returned_string = gives_ownership();
    println!("  ä»å‡½æ•°è·å¾—æ‰€æœ‰æƒ: \"{}\"", returned_string);
    println!();

    println!("=== ç¤ºä¾‹ç»“æŸ ===");
    println!("\nğŸ“š ä¸‹ä¸€æ­¥å­¦ä¹ : cargo run --example 02_move_semantics");

    wait_for_enter();
}

// è¿™ä¸ªå‡½æ•°è·å– String çš„æ‰€æœ‰æƒ
fn takes_ownership(some_string: String) {
    println!("  [å‡½æ•°å†…] æ¥æ”¶åˆ°: \"{}\"", some_string);
}  // some_string ç¦»å¼€ä½œç”¨åŸŸï¼Œå†…å­˜è¢«é‡Šæ”¾

// è¿™ä¸ªå‡½æ•°åªæ˜¯å¤åˆ¶äº†ä¸€ä¸ª i32
fn makes_copy(some_integer: i32) {
    println!("  [å‡½æ•°å†…] æ¥æ”¶åˆ°: {}", some_integer);
}  // some_integer ç¦»å¼€ä½œç”¨åŸŸï¼Œä½†åªæ˜¯æ ˆä¸Šçš„å‰¯æœ¬ï¼ŒåŸå€¼ä¸å—å½±å“

// è¿™ä¸ªå‡½æ•°åˆ›å»ºå¹¶è¿”å›ä¸€ä¸ª Stringï¼Œæ‰€æœ‰æƒè½¬ç§»ç»™è°ƒç”¨è€…
fn gives_ownership() -> String {
    let some_string = String::from("å‡½æ•°åˆ›å»ºçš„å­—ç¬¦ä¸²");
    some_string  // è¿”å›å€¼ï¼Œæ‰€æœ‰æƒè½¬ç§»ç»™è°ƒç”¨è€…
}

// ç­‰å¾…ç”¨æˆ·æŒ‰å›è½¦
fn wait_for_enter() {
    use std::io::{self, Write};
    println!();
    print!("æŒ‰å›è½¦é”®é€€å‡º...");
    io::stdout().flush().unwrap();
    let mut input = String::new();
    io::stdin().read_line(&mut input).unwrap();
}
