// ============================================================
// associated_fn.rs - å…³è”å‡½æ•°ï¼ˆString::from çš„ç§˜å¯†ï¼ï¼‰
// ============================================================
//
// ğŸ¯ å­¦ä¹ ç›®æ ‡ï¼šç†è§£ String::from("hello") åˆ°åº•æ˜¯ä»€ä¹ˆ
//
// å…³è”å‡½æ•° = ä¸éœ€è¦å®ä¾‹å°±èƒ½è°ƒç”¨çš„å‡½æ•°
// ç”¨ :: è°ƒç”¨ï¼Œç±»ä¼¼å…¶ä»–è¯­è¨€çš„"é™æ€æ–¹æ³•"æˆ–"æ„é€ å‡½æ•°"
//
// è¿è¡Œæ–¹å¼ï¼šcargo run -p c05-structs --bin associated_fn
// ============================================================

fn main() {
    println!("=== å…³è”å‡½æ•° - String::from çš„ç§˜å¯†ï¼ ===\n");

    // --------------------------------------------------------
    // ğŸ“Œ å›é¡¾ï¼šæ–¹æ³•éœ€è¦å®ä¾‹
    // --------------------------------------------------------
    println!("ã€1ã€‘å›é¡¾ï¼šæ–¹æ³•éœ€è¦å…ˆæœ‰å®ä¾‹");
    println!();

    let rect = Rectangle::new(30, 50);  // å…ˆåˆ›å»ºå®ä¾‹
    let area = rect.area();              // ç„¶åè°ƒç”¨æ–¹æ³•

    println!("  å…ˆåˆ›å»º: let rect = Rectangle::new(30, 50);");
    println!("  å†è°ƒç”¨: rect.area() = {}", area);
    println!();
    println!("  æ–¹æ³•ç”¨ç‚¹å·(.)è°ƒç”¨ï¼Œéœ€è¦å®ä¾‹");
    println!();

    // --------------------------------------------------------
    // ğŸ“Œ é—®é¢˜ï¼šå¦‚ä½•åˆ›å»ºç¬¬ä¸€ä¸ªå®ä¾‹ï¼Ÿ
    // --------------------------------------------------------
    println!("ã€2ã€‘é—®é¢˜ï¼šå¦‚ä½•åˆ›å»ºç¬¬ä¸€ä¸ªå®ä¾‹ï¼Ÿ");
    println!();
    println!("  ğŸ¤” rect.area() éœ€è¦ rect");
    println!("  ğŸ¤” ä½† rect ä»å“ªæ¥ï¼Ÿ");
    println!("  ğŸ¤” éœ€è¦ä¸€ç§ã€Œä¸ä¾èµ–å®ä¾‹ã€çš„å‡½æ•°æ¥åˆ›å»ºå®ä¾‹ï¼");
    println!();

    // --------------------------------------------------------
    // ğŸ“Œ è§£å†³æ–¹æ¡ˆï¼šå…³è”å‡½æ•°
    // --------------------------------------------------------
    println!("ã€3ã€‘è§£å†³æ–¹æ¡ˆï¼šå…³è”å‡½æ•°");
    println!();

    // å…³è”å‡½æ•°ç”¨ :: è°ƒç”¨
    let rect1 = Rectangle::new(10, 20);        // ç”¨ :: è°ƒç”¨
    let square = Rectangle::square(15);        // ç”¨ :: è°ƒç”¨

    println!("  å…³è”å‡½æ•°ç”¨åŒå†’å·(::)è°ƒç”¨ï¼Œä¸éœ€è¦å®ä¾‹ï¼š");
    println!("  Rectangle::new(10, 20)  -> {}x{}", rect1.width, rect1.height);
    println!("  Rectangle::square(15)   -> {}x{}", square.width, square.height);
    println!();

    // --------------------------------------------------------
    // ğŸ“Œ æ–¹æ³• vs å…³è”å‡½æ•°
    // --------------------------------------------------------
    println!("ã€4ã€‘æ–¹æ³• vs å…³è”å‡½æ•° å¯¹æ¯”");
    println!();
    println!("  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”");
    println!("  â”‚              â”‚ æ–¹æ³•                â”‚ å…³è”å‡½æ•°            â”‚");
    println!("  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤");
    println!("  â”‚ ç¬¬ä¸€ä¸ªå‚æ•°   â”‚ selfï¼ˆè‡ªèº«å®ä¾‹ï¼‰    â”‚ æ²¡æœ‰ self           â”‚");
    println!("  â”‚ è°ƒç”¨æ–¹å¼     â”‚ instance.method()   â”‚ Type::function()    â”‚");
    println!("  â”‚ è°ƒç”¨ç¬¦å·     â”‚ ç‚¹å· (.)            â”‚ åŒå†’å· (::)         â”‚");
    println!("  â”‚ éœ€è¦å®ä¾‹ï¼Ÿ   â”‚ âœ… éœ€è¦              â”‚ âŒ ä¸éœ€è¦           â”‚");
    println!("  â”‚ å¸¸è§ç”¨é€”     â”‚ æ“ä½œå®ä¾‹            â”‚ åˆ›å»ºå®ä¾‹            â”‚");
    println!("  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜");
    println!();

    // --------------------------------------------------------
    // ğŸ“Œ String::from çš„çœŸç›¸
    // --------------------------------------------------------
    println!("ã€5ã€‘ğŸ¯ String::from çš„çœŸç›¸ï¼");
    println!();
    println!("  String::from(\"hello\") å°±æ˜¯ï¼š");
    println!("    - String æ˜¯ä¸€ä¸ªç»“æ„ä½“ç±»å‹");
    println!("    - from æ˜¯ String çš„ä¸€ä¸ªå…³è”å‡½æ•°");
    println!("    - :: æ˜¯è°ƒç”¨å…³è”å‡½æ•°çš„ç¬¦å·");
    println!("    - \"hello\" æ˜¯ä¼ å…¥çš„å‚æ•°");
    println!();
    println!("  ç¿»è¯‘æˆäººè¯ï¼š");
    println!("    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”");
    println!("    â”‚  String::from(\"hello\")                    â”‚");
    println!("    â”‚     â†“                                     â”‚");
    println!("    â”‚  å» String ç±»å‹é‚£é‡Œ                       â”‚");
    println!("    â”‚  è°ƒç”¨ from è¿™ä¸ªå…³è”å‡½æ•°                   â”‚");
    println!("    â”‚  ç”¨ \"hello\" ä½œä¸ºåŸæ–™                      â”‚");
    println!("    â”‚  ç”Ÿäº§ä¸€ä¸ª String å®ä¾‹                     â”‚");
    println!("    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜");
    println!();

    // éªŒè¯ä¸€ä¸‹
    let s = String::from("hello");
    println!("  å®é™…ä½¿ç”¨ï¼šlet s = String::from(\"hello\");");
    println!("  ç»“æœï¼šs = \"{}\"", s);
    println!();

    // --------------------------------------------------------
    // ğŸ“Œ å¸¸è§çš„å…³è”å‡½æ•°
    // --------------------------------------------------------
    println!("ã€6ã€‘å¸¸è§çš„å…³è”å‡½æ•°");
    println!();

    // String ç›¸å…³
    let s1 = String::new();           // åˆ›å»ºç©ºå­—ç¬¦ä¸²
    let s2 = String::from("hello");   // ä» &str åˆ›å»º
    let s3 = String::with_capacity(100);  // é¢„åˆ†é…å®¹é‡

    println!("  String çš„å…³è”å‡½æ•°ï¼š");
    println!("    String::new()              -> ç©ºå­—ç¬¦ä¸²");
    println!("    String::from(\"hello\")      -> \"{}\"", s2);
    println!("    String::with_capacity(100) -> é¢„åˆ†é…å®¹é‡");
    println!();

    // Vec ç›¸å…³
    let v1: Vec<i32> = Vec::new();    // åˆ›å»ºç©º Vec
    let v2 = Vec::from([1, 2, 3]);    // ä»æ•°ç»„åˆ›å»º

    println!("  Vec çš„å…³è”å‡½æ•°ï¼š");
    println!("    Vec::new()           -> ç©ºæ•°ç»„");
    println!("    Vec::from([1,2,3])   -> {:?}", v2);
    println!();

    // --------------------------------------------------------
    // ğŸ“Œ è‡ªå·±å®šä¹‰å…³è”å‡½æ•°
    // --------------------------------------------------------
    println!("ã€7ã€‘è‡ªå·±å®šä¹‰å…³è”å‡½æ•°");
    println!();
    println!("  è¯­æ³•ï¼šåœ¨ impl å—é‡Œï¼Œå‡½æ•°ç¬¬ä¸€ä¸ªå‚æ•°ä¸æ˜¯ self");
    println!();
    println!("  impl Rectangle {{");
    println!("      // è¿™æ˜¯å…³è”å‡½æ•°ï¼ˆæ²¡æœ‰ selfï¼‰");
    println!("      fn new(width: u32, height: u32) -> Rectangle {{");
    println!("          Rectangle {{ width, height }}");
    println!("      }}");
    println!();
    println!("      // è¿™æ˜¯æ–¹æ³•ï¼ˆæœ‰ selfï¼‰");
    println!("      fn area(&self) -> u32 {{");
    println!("          self.width * self.height");
    println!("      }}");
    println!("  }}");
    println!();

    // --------------------------------------------------------
    // ğŸ“Œ å®Œæ•´å¯¹æ¯”å›¾
    // --------------------------------------------------------
    println!("ã€8ã€‘å®Œæ•´å¯¹æ¯”å›¾");
    println!();
    println!("  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”");
    println!("  â”‚                      impl Rectangle                     â”‚");
    println!("  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤");
    println!("  â”‚  å…³è”å‡½æ•°ï¼ˆç”¨ :: è°ƒç”¨ï¼‰          æ–¹æ³•ï¼ˆç”¨ . è°ƒç”¨ï¼‰      â”‚");
    println!("  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€          â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚");
    println!("  â”‚  fn new(w, h) -> Self           fn area(&self) -> u32   â”‚");
    println!("  â”‚  fn square(size) -> Self        fn perimeter(&self)     â”‚");
    println!("  â”‚                                 fn double(&mut self)    â”‚");
    println!("  â”‚  æ²¡æœ‰ self å‚æ•°                 ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ self       â”‚");
    println!("  â”‚  Rectangle::new(10, 20)         rect.area()             â”‚");
    println!("  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜");
    println!();

    // --------------------------------------------------------
    // ğŸ“Œ æ€»ç»“
    // --------------------------------------------------------
    println!("ã€æ€»ç»“ã€‘String::from(\"hello\") å®Œå…¨è§£æ");
    println!();
    println!("  String  ::  from  (  \"hello\"  )");
    println!("    â†“         â†“          â†“");
    println!("  ç»“æ„ä½“     å…³è”å‡½æ•°   å‚æ•°");
    println!("  ç±»å‹å     çš„åå­—     å€¼");
    println!();
    println!("  = è°ƒç”¨ String ç»“æ„ä½“çš„ from å…³è”å‡½æ•°ï¼Œä¼ å…¥ \"hello\"");
    println!("  = è¿”å›ä¸€ä¸ªæ–°çš„ String å®ä¾‹");
    println!();

    // æ¶ˆé™¤ç¼–è¯‘è­¦å‘Š
    let _ = s1;
    let _ = s3;
    let _ = v1;

    println!("=== ç¤ºä¾‹ç»“æŸ ===");
    println!("\nğŸ‰ ç°åœ¨ä½ çŸ¥é“ String::from æ˜¯ä»€ä¹ˆäº†ï¼");
}

// ============================================================
// ç»“æ„ä½“å®šä¹‰
// ============================================================

/// çŸ©å½¢ç»“æ„ä½“
struct Rectangle {
    width: u32,
    height: u32,
}

// ============================================================
// impl å—
// ============================================================

impl Rectangle {
    // ===== å…³è”å‡½æ•°ï¼ˆæ²¡æœ‰ selfï¼Œç”¨ :: è°ƒç”¨ï¼‰=====

    /// åˆ›å»ºæ–°çŸ©å½¢ï¼ˆå…³è”å‡½æ•°ï¼‰
    fn new(width: u32, height: u32) -> Rectangle {
        Rectangle { width, height }
    }

    /// åˆ›å»ºæ­£æ–¹å½¢ï¼ˆå…³è”å‡½æ•°ï¼‰
    fn square(size: u32) -> Rectangle {
        Rectangle {
            width: size,
            height: size,
        }
    }

    // ===== æ–¹æ³•ï¼ˆæœ‰ selfï¼Œç”¨ . è°ƒç”¨ï¼‰=====

    /// è®¡ç®—é¢ç§¯ï¼ˆæ–¹æ³•ï¼‰
    fn area(&self) -> u32 {
        self.width * self.height
    }
}
